<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Snake Game</title>
    <meta charset="UTF-8">
    <meta name="author" content="Vinicius da Costa Souza">

    <!-- Importando folhas de estilo CSS -->
    <link href="static/css/reset.css" rel="stylesheet">
    <link href="static/css/base.css" rel="stylesheet">

    <!-- Importando objetos JavaScript -->
    <script src="src/apple.js" type="text/javascript"></script>
    <script src="src/snake.js" type="text/javascript"></script>
    <script src="src/game.js" type="text/javascript"></script>
    <script src="src/score.js" type="text/javascript"></script>
</head>
<body>
    <canvas id="snake-game" width="500" height="500"></canvas>
    <script>
        const image_apple = new Image();
        image_apple.src = apple.image;
        // Obtendo referencia do elemento Canvas
        const canvas = document.getElementById('snake-game');
        // Obtendo referencia do contexto gráfico
        const ctx = canvas.getContext('2d');
        // Sempre que o usário teclar um evento é repassado para função
        document.onkeydown = function(event){
            switch(event.keyCode){
                case 37:
                snake.direction = "left";
                break;
                case 38:
                snake.direction = "up";
                break;
                case 39:
                snake.direction = "right";
                break;
                case 40:
                snake.direction = "down";
                break;
                default: break;
            };
        };

        // Função que movimentará a cobrinha
        function moveSnake(){
            switch(snake.direction){
                case "left":
                snake.positionX -= game.tile;
                drawSnake();
                break;
                case "up":
                snake.positionY -= game.tile;
                drawSnake();
                break;
                case "right":
                snake.positionX += game.tile;
                drawSnake();
                break;
                case "down":
                snake.positionY += game.tile;
                drawSnake();
                break;
            };
        };

        function drawSnake(){
            // Adiciona uma posição (x,y) ao array snake.body[]
            snake.body.push([snake.positionX, snake.positionY])
            // Atribui uma cor ao contexto gráfico
            ctx.fillStyle = snake.color;
            // Desenha
            ctx.fillRect(snake.positionX, snake.positionY, game.tile, game.tile);
            // Verifica colisão
            snakeCollided()
            // Verifica se o tamanho do array é menor que o atributo size da cobrinha
            if(snake.body.length > snake.size){
                // Recebe o retorno do método shift
                let [removeX, removeY] = snake.body.shift();
                // Apaga o desenho na área correta
                ctx.clearRect(removeX, removeY, game.tile, game.tile);
            };
        };

        function drawApple(){
            apple.positionX, apple.positionY = randomCoordinate();
            ctx.drawImage(image_apple, apple.positionX, apple.positionY, game.tile, game.tile);
        };

        function snakeCollided(){
            if(snake.positionX < apple.positionX + game.tile &&
               snake.positionX + game.tile > apple.positionX &&
               snake.positionY < apple.positionY + game.tile &&
               snake.positionY + game.tile > apple.positionY)
                {
                snake.size += 1;
                ctx.clearRect(apple.positionX, apple.positionY, game.tile, game.tile);
                ctx.fill();
                drawApple();
                };
        };

        function randomCoordinate(){
            let coordinateX = Math.floor(Math.random() * (canvas.width - game.tile));
            let coordinateY = Math.floor(Math.random() * (canvas.height - game.tile));
            return coordinateX, coordinateY;
        };

        image_apple.onload = function(){
            apple.positionX, apple.positionY = randomCoordinate();
            ctx.drawImage(image_apple, apple.positionX, apple.positionY, game.tile, game.tile);
        };
        
        setInterval(moveSnake, snake.velocity);
    </script>
</body>
</html>